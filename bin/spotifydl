#!/bin/bash

red="\033[0;31m"
green="\033[0;32m"
yellow="\033[0;33m"
blue="\033[0;34m"
purple="\033[0;35m"
cyan="\033[0;36m"
white="\033[0;37m"
reset="\033[0m"


function check_dependencies() {
    if ! [ -x "$(command -v spotdl)" ]; then
        echo -e  "$red Error: spotdl is not installed. $reset " >&2
        exit 1
    fi
}

audio_provider=$(echo -e "\nyoutube\nyoutube-music\nslider-kz\nsoundcloud\nbandcamp\npiped" | fzf )
lyrics_provider=$(echo -e "\ngenius\nmusixmatch\nazlyrics\nsynced" | fzf )

function spodl {
   check_dependencies
    printf "${yellow}Enter the URL of the playlist or album you want to download: ${reset}"
    read url
    if [ -z "$url" ]; then
        echo -e  "$red Error: URL is empty. $reset " >&2
        exit 1
    fi
    echo "$url" >> ~/spotifyURLs.txt
    clear
    userAD="$audio_provider"
    userLD="$lyrics_provider"
    spotdl download $url --audio "$userAD" --bitrate 320k --lyrics "$userLD" --output '{title} {artists}'
    clear
}

while true; do 
  spodl 
done
